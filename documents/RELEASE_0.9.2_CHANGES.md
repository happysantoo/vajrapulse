# VajraPulse 0.9.2 Release Changes

## Release Date
November 17, 2025

## Summary
This release addresses Maven Central compliance issues found in v0.9.1 by adding artifact signing and embedding LICENSE files in all JARs.

## Critical Fixes

### 1. Missing GPG Signatures ✅
**Problem**: Maven Central showed "Missing signature" errors for all artifacts in 0.9.1:
- `vajrapulse-MODULE-0.9.1.jar`
- `vajrapulse-MODULE-0.9.1-sources.jar`
- `vajrapulse-MODULE-0.9.1-javadoc.jar`
- `vajrapulse-MODULE-0.9.1.pom`
- `vajrapulse-MODULE-0.9.1.module`

**Root Cause**: The `signing` plugin was not applied or configured in `build.gradle.kts`.

**Solution**: Added signing configuration to all publishable modules:
```kotlin
plugins {
    // ... existing plugins
    signing
}

subprojects {
    apply(plugin = "signing")
    
    // In publishable modules
    signing {
        val signingKey: String? by project
        val signingPassword: String? by project
        useInMemoryPgpKeys(signingKey, signingPassword)
        sign(publishing.publications["mavenJava"])
    }
}
```

**Verification**: All artifacts now have `.asc` signature files (5 per module, 6 for worker with shadow JAR).

### 2. Missing LICENSE in JARs ✅
**Problem**: LICENSE file was not embedded in published JAR artifacts (only referenced in POM metadata).

**Solution**: Added LICENSE inclusion to all JAR tasks:
```kotlin
tasks.withType<Jar> {
    from(rootProject.file("LICENSE")) {
        into("META-INF")
    }
}
```

**Result**: All JAR types (main, sources, javadoc) now contain `META-INF/LICENSE` (11,357 bytes).

## Build Configuration Changes

### Deprecated API Fixes
Replaced deprecated `buildDir` references with `layout.buildDirectory`:
```kotlin
// Before (deprecated)
executionData.setFrom(files("$buildDir/jacoco/test.exec"))

// After (Java 21 compatible)
executionData.setFrom(files(layout.buildDirectory.dir("jacoco/test.exec")))
```

## Affected Modules
All publishable modules updated:
- `vajrapulse-api`
- `vajrapulse-core`
- `vajrapulse-exporter-console`
- `vajrapulse-exporter-opentelemetry`
- `vajrapulse-worker`

## Maven Central Compliance
Version 0.9.2 fully complies with Maven Central requirements:
- ✅ POM with required metadata (name, description, URL, license, SCM, developers)
- ✅ Main JAR
- ✅ Sources JAR (`-sources.jar`)
- ✅ Javadoc JAR (`-javadoc.jar`)
- ✅ GPG signatures for all artifacts (`.asc` files)
- ✅ LICENSE file embedded in all JARs
- ✅ MD5 and SHA1 checksums (generated by bundle script)

## Deployment Prerequisites

### Required in `gradle.properties`:
```properties
mavenCentralUsername=<your-token-username>
mavenCentralPassword=<your-token-password>
signingKey=<ASCII-armored GPG private key>
signingPassword=<GPG key passphrase>
```

### Publishing Steps:
```bash
# 1. Clean and publish to local Maven repository
./gradlew clean publishToMavenLocal

# 2. Create bundle for Maven Central
./scripts/create-central-bundle.sh

# 3. Upload bundle
curl --request POST \
  --verbose \
  --header "Authorization: Bearer $MAVEN_CENTRAL_TOKEN" \
  --form bundle=@/tmp/vajrapulse-0.9.2-bundle.zip \
  "https://central.sonatype.com/api/v1/publisher/upload?name=vajrapulse-0.9.2&publishingType=AUTOMATIC"

# 4. Tag and push release
git tag -a v0.9.2 -m "Release v0.9.2 - Maven Central compliance fixes"
git push origin v0.9.2
```

## Documentation Updates
- `documents/LICENSE_PUBLISHING.md` - Updated with signing configuration
- `documents/RELEASE_0.9.2_CHANGES.md` - This file

## Breaking Changes
None - purely compliance and quality improvements.

## Migration from 0.9.1
Simply update version in your dependency declarations:
```kotlin
// Gradle
implementation("com.vajrapulse:vajrapulse-core:0.9.2")

// Maven
<dependency>
    <groupId>com.vajrapulse</groupId>
    <artifactId>vajrapulse-core</artifactId>
    <version>0.9.2</version>
</dependency>
```

## Known Issues
None

## Future Improvements
- Consider automating GPG key management for CI/CD
- Add signature verification to bundle script
- Explore GitHub Actions for automated releases
